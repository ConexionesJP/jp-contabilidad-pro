<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JP ENTERPRISE | POS Profesional</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --main: #00d2ff; --accent: #bc13fe; --bg: #0a0a12; --card: #161625; --text: #e0e0e0; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; height: 100vh; overflow: hidden; }
        .sidebar { width: 250px; background: #000; padding: 20px; border-right: 1px solid #222; display: flex; flex-direction: column; }
        .nav-item { padding: 15px; border-radius: 10px; cursor: pointer; transition: 0.3s; margin-bottom: 10px; display: flex; align-items: center; gap: 10px; color: #888; }
        .nav-item:hover, .nav-item.active { background: rgba(0, 210, 255, 0.1); color: var(--main); }
        .main { flex: 1; padding: 30px; overflow-y: auto; }
        .page { display: none; animation: fadeIn 0.3s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .card { background: var(--card); border-radius: 15px; padding: 25px; border: 1px solid #333; margin-bottom: 20px; }
        input, select { width: 100%; padding: 12px; background: #0a0a12; border: 1px solid #444; border-radius: 8px; color: white; margin: 10px 0; box-sizing: border-box; }
        .btn { border: none; padding: 12px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; }
        .btn-main { background: var(--main); color: #000; }
        .btn-accent { background: var(--accent); color: #fff; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid #222; }
        th { color: var(--main); font-size: 0.8rem; text-transform: uppercase; }
        .stat-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: #1e1e2f; padding: 20px; border-radius: 15px; border: 1px solid #333; text-align: center; }
        .total-box { background: rgba(0, 210, 255, 0.1); padding: 20px; border-radius: 10px; border: 1px solid var(--main); margin-top: 10px; text-align: center; }
    </style>
</head>
<body>

    <nav class="sidebar">
        <h2 style="color:var(--main); text-align: center;">JP ERP</h2>
        <div class="nav-item active" onclick="showPage('dashboard', this)"><i class="fas fa-chart-line"></i> Dashboard</div>
        <div class="nav-item" onclick="showPage('inventario', this)"><i class="fas fa-boxes"></i> Inventario</div>
        <div class="nav-item" onclick="showPage('ventas', this)"><i class="fas fa-cash-register"></i> Ventas</div>
        <div class="nav-item" onclick="finalizarDia()" style="margin-top: auto; color: #ff4757;"><i class="fas fa-power-off"></i> Cierre de DÃ­a</div>
    </nav>

    <div class="main">
        
        <div id="dashboard" class="page active">
            <h1>Panel de Control</h1>
            <div class="stat-grid">
                <div class="stat-card"><small>Utilidad Neta Hoy</small><div id="dash-ganancia" style="font-size: 1.5rem; color: #2ecc71; font-weight: bold;">$ 0</div></div>
                <div class="stat-card"><small>Unidades Vendidas</small><div id="dash-ventas" style="font-size: 1.5rem; font-weight: bold;">0</div></div>
                <div class="stat-card"><small>Top Producto</small><div id="dash-top" style="font-size: 1rem; color: var(--main);">---</div></div>
            </div>
            <div class="card">
                <h3>Historial de Cierres Diarios</h3>
                <div id="historial-lista"></div>
            </div>
        </div>

        <div id="inventario" class="page">
            <h1>GestiÃ³n de Inventario</h1>
            <div class="card">
                <h3>Agregar Producto</h3>
                <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 10px;">
                    <input type="text" id="inv-nombre" placeholder="Nombre">
                    <input type="number" id="inv-costo" placeholder="Costo Unit.">
                    <input type="number" id="inv-venta" placeholder="Venta Unit.">
                    <input type="number" id="inv-stock" placeholder="Stock Inicial">
                </div>
                <button class="btn btn-main" onclick="agregarProducto()">Guardar Producto</button>
            </div>
            <div class="card">
                <table>
                    <thead><tr><th>Producto</th><th>Costo</th><th>Venta</th><th>Stock</th><th>AcciÃ³n</th></tr></thead>
                    <tbody id="tabla-inventario"></tbody>
                </table>
            </div>
        </div>

        <div id="ventas" class="page">
            <h1>Caja de Ventas</h1>
            <div class="grid-ventas" style="display: grid; grid-template-columns: 1.5fr 1fr; gap: 20px;">
                <div class="card">
                    <h3>1. Seleccionar Producto</h3>
                    <input type="text" id="busqueda" placeholder="ðŸ” Buscar producto..." onkeyup="actualizarSelectVenta()">
                    <select id="select-venta" size="8" onchange="calcularTotalVenta()"></select>
                </div>
                <div class="card">
                    <h3>2. Detalles de Venta</h3>
                    <label>Cantidad a llevar:</label>
                    <input type="number" id="venta-cantidad" value="1" min="1" oninput="calcularTotalVenta()">
                    
                    <div class="total-box">
                        <small>TOTAL A COBRAR:</small>
                        <div id="total-cobrar" style="font-size: 1.8rem; font-weight: bold; color: var(--main);">$ 0</div>
                    </div>
                    
                    <button class="btn btn-accent" onclick="registrarVenta()">CONFIRMAR VENTA</button>
                </div>
            </div>
        </div>

    </div>

<script>
    const fmt = new Intl.NumberFormat('es-CO', { style: 'currency', currency: 'COP', maximumFractionDigits: 0 });
    let db = JSON.parse(localStorage.getItem('jp_pro_db_v2')) || { productos: [], ventasHoy: [], historial: [] };

    function showPage(pageId, element) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        element.classList.add('active');
        actualizarInterfaz();
    }

    function agregarProducto() {
        const n = document.getElementById('inv-nombre').value;
        const c = parseFloat(document.getElementById('inv-costo').value);
        const v = parseFloat(document.getElementById('inv-venta').value);
        const s = parseInt(document.getElementById('inv-stock').value);
        if(n && c && v && s) {
            db.productos.push({ n, c, v, s, vh: 0 });
            guardar();
            document.querySelectorAll('#inventario input').forEach(i => i.value = "");
        }
    }

    function calcularTotalVenta() {
        const idx = document.getElementById('select-venta').value;
        const cant = parseInt(document.getElementById('venta-cantidad').value) || 0;
        if(idx !== "") {
            const precio = db.productos[idx].v;
            document.getElementById('total-cobrar').innerText = fmt.format(precio * cant);
        } else {
            document.getElementById('total-cobrar').innerText = "$ 0";
        }
    }

    function registrarVenta() {
        const idx = document.getElementById('select-venta').value;
        const cant = parseInt(document.getElementById('venta-cantidad').value) || 0;
        if(idx === "" || cant <= 0) return alert("Selecciona un producto y cantidad vÃ¡lida");

        const p = db.productos[idx];
        if(p.s >= cant) {
            p.s -= cant;
            p.vh += cant;
            const gananciaUnit = p.v - p.c;
            db.ventasHoy.push({ n: p.n, g: (gananciaUnit * cant), v: (p.v * cant), c: cant });
            guardar();
            document.getElementById('venta-cantidad').value = 1;
            alert("Venta registrada con Ã©xito");
        } else {
            alert("No hay suficiente stock. Disponible: " + p.s);
        }
    }

    function finalizarDia() {
        if(db.ventasHoy.length === 0) return alert("No hay ventas hoy");
        const g = db.ventasHoy.reduce((a, b) => a + b.g, 0);
        const u = db.ventasHoy.reduce((a, b) => a + b.c, 0);
        db.historial.unshift({ f: new Date().toLocaleString(), g: g, u: u });
        db.ventasHoy = [];
        db.productos.forEach(p => p.vh = 0);
        guardar();
        alert("Cierre de dÃ­a completado");
        showPage('dashboard', document.querySelector('.nav-item'));
    }

    function guardar() {
        localStorage.setItem('jp_pro_db_v2', JSON.stringify(db));
        actualizarInterfaz();
    }

    function actualizarInterfaz() {
        document.getElementById('tabla-inventario').innerHTML = db.productos.map((p, i) => `
            <tr><td>${p.n}</td><td>${fmt.format(p.c)}</td><td>${fmt.format(p.v)}</td><td>${p.s}</td>
            <td><button onclick="eliminarProducto(${i})" style="color:red; background:none; border:none; cursor:pointer;">âœ–</button></td></tr>
        `).join('');

        actualizarSelectVenta();

        const ganancia = db.ventasHoy.reduce((a, b) => a + b.g, 0);
        const unidades = db.ventasHoy.reduce((a, b) => a + b.c, 0);
        document.getElementById('dash-ganancia').innerText = fmt.format(ganancia);
        document.getElementById('dash-ventas').innerText = unidades;
        
        const top = [...db.productos].sort((a,b) => b.vh - a.vh)[0];
        document.getElementById('dash-top').innerText = top && top.vh > 0 ? top.n.toUpperCase() : "---";

        document.getElementById('historial-lista').innerHTML = db.historial.map(h => `
            <div style="padding:10px; border-bottom:1px solid #333; font-size:0.8rem">
                ${h.f} - Utilidad: <span style="color:#2ecc71">${fmt.format(h.g)}</span> (${h.u} und.)
            </div>
        `).join('');
        calcularTotalVenta();
    }

    function actualizarSelectVenta() {
        const q = document.getElementById('busqueda').value.toLowerCase();
        document.getElementById('select-venta').innerHTML = db.productos
            .map((p, i) => ({p, i}))
            .filter(x => x.p.n.toLowerCase().includes(q))
            .map(x => `<option value="${x.i}">${x.p.n.toUpperCase()} - ${fmt.format(x.p.v)} (Stock: ${x.p.s})</option>`)
            .join('');
    }

    function eliminarProducto(i) {
        if(confirm("Â¿Eliminar producto?")) { db.productos.splice(i, 1); guardar(); }
    }

    actualizarInterfaz();
</script>
</body>
</html>
