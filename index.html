<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>JP CONTABILIDAD | Sistema de Ventas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --cian: #00d2ff; --morado: #bc13fe; --fondo: #050505; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--fondo); color: white; margin: 0; padding: 20px; }
        .grid-principal { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; max-width: 1200px; margin: auto; }
        .card { background: #111; border: 1px solid #333; padding: 20px; border-radius: 15px; }
        h2 { color: var(--cian); border-bottom: 1px solid #333; padding-bottom: 10px; }
        
        input, select { width: 90%; padding: 10px; margin: 10px 0; background: #000; color: white; border: 1px solid var(--cian); border-radius: 5px; }
        button { width: 100%; padding: 12px; font-weight: bold; cursor: pointer; border-radius: 8px; border: none; transition: 0.3s; margin-top: 10px; }
        
        .btn-venta { background: var(--cian); color: black; }
        .btn-guardar { background: #222; color: white; border: 1px solid #444; }
        .btn-cierre { background: var(--morado); color: white; font-size: 1.1rem; margin-top: 20px; }
        
        .stats-box { background: linear-gradient(135deg, #1a1a1a, #000); padding: 15px; border-radius: 10px; text-align: center; border: 1px solid #444; }
        .ganancia-numero { font-size: 2rem; color: #2ecc71; font-weight: bold; }
        .top-product { font-size: 1.5rem; color: #f1c40f; }

        table { width: 100%; margin-top: 10px; text-align: left; border-collapse: collapse; }
        th, td { padding: 10px; border-bottom: 1px solid #222; }
        .historial-item { font-size: 0.9rem; color: #aaa; background: #1a1a1a; margin-bottom: 5px; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>

    <h1 style="text-align:center; color:white;">üìä PANEL CONTABLE <span style="color:var(--cian)">CONEXIONES JP</span></h1>

    <div class="grid-principal">
        
        <div>
            <div class="card">
                <h2><i class="fas fa-box"></i> 1. Inventario</h2>
                <input type="text" id="nombreP" placeholder="Nombre del programa o servicio">
                <input type="number" id="costoP" placeholder="Costo de producci√≥n ($)">
                <input type="number" id="ventaP" placeholder="Precio de venta ($)">
                <button class="btn-guardar" onclick="agregarProducto()">+ AGREGAR AL CAT√ÅLOGO</button>
            </div>

            <div class="card" style="margin-top:20px;">
                <h2><i class="fas fa-cart-plus"></i> 2. Registrar Venta</h2>
                <select id="listaProductos"></select>
                <button class="btn-venta" onclick="registrarVenta()">REGISTRAR VENTA DE AHORA</button>
            </div>
        </div>

        <div>
            <div class="card">
                <h2><i class="fas fa-chart-line"></i> Estad√≠sticas del D√≠a</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div class="stats-box">
                        <p>GANANCIA TOTAL</p>
                        <div id="gananciaTotal" class="ganancia-numero">$0</div>
                    </div>
                    <div class="stats-box">
                        <p>M√ÅS VENDIDO üëë</p>
                        <div id="productoTop" class="top-product">---</div>
                    </div>
                </div>
                
                <button class="btn-cierre" onclick="finalizarDia()">
                    <i class="fas fa-flag-checkered"></i> FINALIZAR D√çA Y GUARDAR HISTORIAL
                </button>
            </div>

            <div class="card" style="margin-top:20px;">
                <h2><i class="fas fa-history"></i> Historial de Cierres</h2>
                <div id="contenedorHistorial">
                    </div>
            </div>
        </div>

    </div>

<script>
    let productos = JSON.parse(localStorage.getItem('jp_prods')) || [];
    let ventasDelDia = JSON.parse(localStorage.getItem('jp_ventas_dia')) || [];
    let historialCierres = JSON.parse(localStorage.getItem('jp_historial')) || [];

    function agregarProducto() {
        const n = document.getElementById('nombreP').value;
        const c = parseFloat(document.getElementById('costoP').value);
        const v = parseFloat(document.getElementById('ventaP').value);

        if(n && c && v) {
            productos.push({ nombre: n, costo: c, venta: v, cantidadVentas: 0 });
            localStorage.setItem('jp_prods', JSON.stringify(productos));
            actualizarInterfaz();
            alert("Producto guardado");
        }
    }

    function registrarVenta() {
        const index = document.getElementById('listaProductos').value;
        if(index !== "") {
            const p = productos[index];
            p.cantidadVentas += 1;
            ventasDelDia.push({ nombre: p.nombre, ganancia: (p.venta - p.costo), fecha: new Date().toLocaleString() });
            
            localStorage.setItem('jp_prods', JSON.stringify(productos));
            localStorage.setItem('jp_ventas_dia', JSON.stringify(ventasDelDia));
            actualizarInterfaz();
        }
    }

    function finalizarDia() {
        if(ventasDelDia.length === 0) return alert("No hay ventas hoy");

        let gananciaDia = ventasDelDia.reduce((total, v) => total + v.ganancia, 0);
        let masVendido = [...productos].sort((a,b) => b.cantidadVentas - a.cantidadVentas)[0].nombre;

        const cierre = {
            fecha: new Date().toLocaleDateString(),
            totalGanado: gananciaDia,
            productoEstrella: masVendido,
            numVentas: ventasDelDia.length
        };

        historialCierres.unshift(cierre);
        localStorage.setItem('jp_historial', JSON.stringify(historialCierres));

        // Limpiar d√≠a
        ventasDelDia = [];
        productos.forEach(p => p.cantidadVentas = 0);
        localStorage.setItem('jp_ventas_dia', JSON.stringify(ventasDelDia));
        localStorage.setItem('jp_prods', JSON.stringify(productos));
        
        actualizarInterfaz();
        alert("¬°D√≠a finalizado! Datos guardados en el historial.");
    }

    function actualizarInterfaz() {
        // Actualizar Select
        const select = document.getElementById('listaProductos');
        select.innerHTML = productos.map((p, i) => `<option value="${i}">${p.nombre} ($${p.venta})</option>`).join('');

        // Ganancia y Top
        let ganancia = ventasDelDia.reduce((total, v) => total + v.ganancia, 0);
        document.getElementById('gananciaTotal').innerText = `$${ganancia.toLocaleString()}`;

        let top = [...productos].sort((a,b) => b.cantidadVentas - a.cantidadVentas);
        document.getElementById('productoTop').innerText = top[0] && top[0].cantidadVentas > 0 ? top[0].nombre : "---";

        // Historial
        const histDiv = document.getElementById('contenedorHistorial');
        histDiv.innerHTML = historialCierres.map(h => `
            <div class="historial-item">
                <b>üìÖ ${h.fecha}</b> | Ganancia: <span style="color:#2ecc71">$${h.totalGanado}</span><br>
                üöÄ Top: ${h.productoEstrella} (${h.numVentas} ventas)
            </div>
        `).join('');
    }

    actualizarInterfaz();
</script>

</body>
</html>
