<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JP ENTERPRISE | ERP & POS Sistema Contable</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* DISEÃ‘O DE INTERFAZ PROFESIONAL */
        :root { --main: #00d2ff; --accent: #bc13fe; --bg: #05050a; --card: #12121f; --text: #f0f0f0; --success: #00ff88; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        .sidebar { width: 260px; background: #000; padding: 30px 20px; border-right: 1px solid #222; display: flex; flex-direction: column; }
        .nav-item { padding: 16px; border-radius: 12px; cursor: pointer; transition: 0.3s; margin-bottom: 8px; display: flex; align-items: center; gap: 15px; color: #777; font-weight: 500; }
        .nav-item:hover, .nav-item.active { background: rgba(0,210,255,0.1); color: var(--main); }
        
        .main { flex: 1; padding: 40px; overflow-y: auto; scroll-behavior: smooth; }
        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.4s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card { background: var(--card); border-radius: 20px; padding: 25px; border: 1px solid #222; margin-bottom: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .stat-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: var(--card); padding: 20px; border-radius: 15px; border-left: 4px solid var(--main); text-align: center; }

        input, select { width: 100%; padding: 14px; background: #080810; border: 1px solid #333; border-radius: 12px; color: white; margin: 10px 0; box-sizing: border-box; font-size: 1rem; }
        .btn { border: none; padding: 15px; border-radius: 12px; font-weight: bold; cursor: pointer; width: 100%; transition: 0.3s; text-transform: uppercase; margin-top: 10px; }
        .btn-main { background: var(--main); color: #000; }
        .btn-accent { background: var(--accent); color: #fff; }
        .btn-print { background: #fff; color: #000; display: none; }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { text-align: left; padding: 15px; border-bottom: 1px solid #222; }
        th { color: var(--main); font-size: 0.8rem; }
        .stock-low { color: #ff4d4d; font-weight: bold; }

        /* ESTILOS DE IMPRESIÃ“N */
        #ticket-print { display: none; }
        @media print {
            body * { visibility: hidden; }
            #ticket-print, #ticket-print * { visibility: visible; }
            #ticket-print { display: block; position: absolute; left: 0; top: 0; width: 80mm; color: #000; background: #fff; padding: 15px; font-family: 'Courier New', monospace; }
        }
    </style>
</head>
<body>

    <nav class="sidebar">
        <div style="text-align: center; margin-bottom: 30px;">
            <h2 style="color:var(--main); margin:0;">JP ERP</h2>
            <small style="color:#555">ULTIMATE EDITION</small>
        </div>
        <div class="nav-item active" onclick="showPage('dashboard', this)"><i class="fas fa-chart-line"></i> Dashboard</div>
        <div class="nav-item" onclick="showPage('inventario', this)"><i class="fas fa-boxes"></i> Inventario</div>
        <div class="nav-item" onclick="showPage('ventas', this)"><i class="fas fa-cash-register"></i> Ventas</div>
        <div class="nav-item" onclick="finalizarDia()" style="margin-top:auto; color:#ff4d4d;"><i class="fas fa-power-off"></i> Cerrar Caja</div>
    </nav>

    <div class="main">
        
        <div id="dashboard" class="page active">
            <h1>Panel de Control</h1>
            <div class="stat-grid">
                <div class="stat-card"><small>UTILIDAD NETA HOY</small><div id="d-ganancia" style="font-size: 1.8rem; color: var(--success); font-weight: 800;">$ 0</div></div>
                <div class="stat-card"><small>PRODUCTOS VENDIDOS</small><div id="d-cant" style="font-size: 1.8rem; font-weight: 800;">0</div></div>
            </div>
            <div class="card">
                <h3>Ventas de la Semana</h3>
                <canvas id="ventasChart" height="100"></canvas>
            </div>
            <div class="card">
                <h3>Cierres de Caja Recientes</h3>
                <div id="hist-lista"></div>
            </div>
        </div>

        <div id="inventario" class="page">
            <h1>GestiÃ³n de Productos</h1>
            <div class="card">
                <h3>+ Agregar Producto</h3>
                <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 10px;">
                    <input type="text" id="i-nom" placeholder="Nombre">
                    <input type="number" id="i-cos" placeholder="Costo ($)">
                    <input type="number" id="i-ven" placeholder="Venta ($)">
                    <input type="number" id="i-sto" placeholder="Stock">
                </div>
                <button class="btn btn-main" onclick="agregarProducto()">Guardar Producto</button>
            </div>
            <div class="card">
                <table id="tab-inv">
                    <thead><tr><th>Nombre</th><th>Costo</th><th>Venta</th><th>Stock</th><th>AcciÃ³n</th></tr></thead>
                    <tbody id="body-inv"></tbody>
                </table>
            </div>
        </div>

        <div id="ventas" class="page">
            <h1>Caja Registradora</h1>
            <div style="display: grid; grid-template-columns: 1.5fr 1fr; gap: 20px;">
                <div class="card">
                    <h3>1. Seleccionar</h3>
                    <input type="text" placeholder="ðŸ” Buscar producto..." onkeyup="filtrarVenta(this.value)">
                    <select id="sel-venta" size="12" onchange="calcTotal()"></select>
                </div>
                <div class="card">
                    <h3>2. LiquidaciÃ³n</h3>
                    <label>Cantidad:</label>
                    <input type="number" id="v-cant" value="1" min="1" oninput="calcTotal()">
                    <label>Descuento Especial (COP):</label>
                    <input type="number" id="v-desc" value="0" placeholder="0" oninput="calcTotal()">
                    
                    <div style="padding: 20px; border: 1px solid var(--main); border-radius: 15px; margin-top: 15px; text-align: center;">
                        <small>TOTAL A COBRAR:</small>
                        <div id="total-v" style="font-size: 2.2rem; font-weight: bold; color: #fff;">$ 0</div>
                    </div>
                    
                    <button class="btn btn-accent" onclick="ejecutarVenta()">PROCESAR PAGO</button>
                    <button id="btn-print" class="btn btn-print" onclick="window.print()">
                        <i class="fas fa-print"></i> IMPRIMIR FACTURA
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="ticket-print">
        <div style="text-align: center; border-bottom: 1px dashed #000; padding-bottom: 10px;">
            <h2 style="margin:0;">CONEXIONES JP</h2>
            <p style="margin:0; font-size:12px;">Soluciones TecnolÃ³gicas</p>
            <p id="t-fecha" style="font-size:10px;"></p>
        </div>
        <div style="padding: 10px 0; font-size: 14px;">
            <div style="display:flex; justify-content: space-between;">
                <span id="t-prod">Producto</span>
                <span id="t-cant">x0</span>
            </div>
            <div style="text-align: right; margin-top:10px;" id="t-sub">Sub: $0</div>
            <div style="text-align: right;" id="t-desc">Desc: -$0</div>
            <div style="text-align: right; border-top: 1px solid #000; font-size: 18px; font-weight: bold;" id="t-total">TOTAL: $0</div>
        </div>
        <p style="text-align: center; font-size: 10px; margin-top: 20px;">Â¡Gracias por tu compra!<br>Software por Conexiones JP</p>
    </div>

<script>
    const fmt = new Intl.NumberFormat('es-CO', { style: 'currency', currency: 'COP', maximumFractionDigits: 0 });
    let db = JSON.parse(localStorage.getItem('jp_erp_v5')) || { prods: [], ventas: [], hist: [] };
    let chart;

    function showPage(id, el) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
        updateUI();
    }

    function agregarProducto() {
        const n = document.getElementById('i-nom').value, c = +document.getElementById('i-cos').value,
              v = +document.getElementById('i-ven').value, s = +document.getElementById('i-sto').value;
        if(n && v) { db.prods.push({n, c, v, s, vh: 0}); save(); resetInputs(); }
    }

    function calcTotal() {
        const i = document.getElementById('sel-venta').value, cant = +document.getElementById('v-cant').value, desc = +document.getElementById('v-desc').value;
        if(i !== "") {
            const t = (db.prods[i].v * cant) - desc;
            document.getElementById('total-v').innerText = fmt.format(t);
        }
    }

    function ejecutarVenta() {
        const i = document.getElementById('sel-venta').value, cant = +document.getElementById('v-cant').value, desc = +document.getElementById('v-desc').value;
        if(i === "") return alert("Selecciona producto");
        const p = db.prods[i];
        if(p.s >= cant) {
            const totalV = (p.v * cant) - desc;
            p.s -= cant; p.vh += cant;
            db.ventas.push({ n: p.n, g: totalV - (p.c * cant), v: totalV, c: cant });
            
            // Preparar Factura
            document.getElementById('t-fecha').innerText = new Date().toLocaleString();
            document.getElementById('t-prod').innerText = p.n;
            document.getElementById('t-cant').innerText = "x" + cant;
            document.getElementById('t-sub').innerText = "Sub: " + fmt.format(p.v * cant);
            document.getElementById('t-desc').innerText = "Desc: -" + fmt.format(desc);
            document.getElementById('t-total').innerText = "TOTAL: " + fmt.format(totalV);
            
            document.getElementById('btn-print').style.display = "block";
            save();
            alert("Pago procesado correctamente");
        } else alert("Stock insuficiente");
    }

    function finalizarDia() {
        if(!db.ventas.length) return alert("Caja vacÃ­a");
        const g = db.ventas.reduce((a,b)=>a+b.g, 0);
        db.hist.unshift({ f: new Date().toLocaleDateString(), g });
        db.ventas = []; db.prods.forEach(p=>p.vh=0);
        save();
        alert("Cierre de dÃ­a exitoso");
    }

    function save() { localStorage.setItem('jp_erp_v5', JSON.stringify(db)); updateUI(); }

    function updateUI() {
        // Inventario
        document.getElementById('body-inv').innerHTML = db.prods.map((p,i) => `
            <tr><td>${p.n}</td><td>${fmt.format(p.c)}</td><td>${fmt.format(p.v)}</td>
            <td class="${p.s < 5 ? 'stock-low':''}">${p.s} und</td>
            <td><button onclick="db.prods.splice(${i},1);save()" style="color:red; background:none; border:none; cursor:pointer;">âœ–</button></td></tr>
        `).join('');

        // Dashboard
        const ganHoy = db.ventas.reduce((a,b)=>a+b.g, 0);
        const cantHoy = db.ventas.reduce((a,b)=>a+b.c, 0);
        document.getElementById('d-ganancia').innerText = fmt.format(ganHoy);
        document.getElementById('d-cant').innerText = cantHoy;
        
        document.getElementById('hist-lista').innerHTML = db.hist.slice(0,5).map(h => `
            <div style="padding:10px; border-bottom:1px solid #222; font-size:0.9rem">ðŸ“… ${h.f} | Utilidad: <span style="color:var(--success)">${fmt.format(h.g)}</span></div>
        `).join('');

        filtrarVenta("");
        renderChart();
    }

    function filtrarVenta(q) {
        document.getElementById('sel-venta').innerHTML = db.prods.map((p,i)=>({p,i})).filter(x=>x.p.n.toLowerCase().includes(q.toLowerCase()))
            .map(x => `<option value="${x.i}">${x.p.n.toUpperCase()} - ${fmt.format(x.p.v)} [Stock: ${x.p.s}]</option>`).join('');
    }

    function resetInputs() { document.querySelectorAll('#inventario input').forEach(i=>i.value=""); }

    function renderChart() {
        const ctx = document.getElementById('ventasChart').getContext('2d');
        if(chart) chart.destroy();
        const data = db.hist.slice(0,7).reverse();
        chart = new Chart(ctx, {
            type: 'bar',
            data: { labels: data.map(d=>d.f), datasets: [{ label: 'Utilidad COP', data: data.map(d=>d.g), backgroundColor: '#00d2ff' }] },
            options: { plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
        });
    }

    updateUI();
</script>
</body>
</html>
