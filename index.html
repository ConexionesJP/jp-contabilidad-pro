<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JP ERP ULTIMATE | Business Intelligence</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --main: #00d2ff; --accent: #bc13fe; --bg: #05050a; --card: #12121f; --text: #f0f0f0; --success: #00ff88; }
        body { font-family: 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* Sidebar Glassmorphism */
        .sidebar { width: 280px; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); padding: 30px 20px; border-right: 1px solid #222; display: flex; flex-direction: column; z-index: 100; }
        .nav-item { padding: 16px; border-radius: 12px; cursor: pointer; transition: 0.3s; margin-bottom: 8px; display: flex; align-items: center; gap: 15px; color: #777; font-weight: 500; }
        .nav-item:hover, .nav-item.active { background: linear-gradient(90deg, rgba(0,210,255,0.2), transparent); color: var(--main); box-shadow: inset 4px 0 0 var(--main); }

        .main { flex: 1; padding: 40px; overflow-y: auto; scroll-behavior: smooth; }
        .page { display: none; animation: slideUp 0.4s ease-out; }
        .page.active { display: block; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* Componentes Estilo Moderno */
        .card { background: var(--card); border-radius: 20px; padding: 30px; border: 1px solid #222; margin-bottom: 25px; box-shadow: 0 15px 35px rgba(0,0,0,0.4); }
        .stat-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: var(--card); padding: 25px; border-radius: 20px; border-left: 5px solid var(--main); position: relative; overflow: hidden; }
        .stat-card i { position: absolute; right: -10px; bottom: -10px; font-size: 5rem; opacity: 0.05; color: white; }

        input, select { width: 100%; padding: 14px; background: #080810; border: 1px solid #333; border-radius: 12px; color: white; margin: 10px 0; font-size: 1rem; transition: 0.3s; }
        input:focus { border-color: var(--main); outline: none; box-shadow: 0 0 10px rgba(0,210,255,0.2); }

        .btn { border: none; padding: 15px 25px; border-radius: 12px; font-weight: 700; cursor: pointer; width: 100%; transition: 0.3s; text-transform: uppercase; letter-spacing: 1px; }
        .btn-main { background: var(--main); color: #000; }
        .btn-accent { background: linear-gradient(45deg, var(--accent), #6a11cb); color: #fff; }
        .btn:hover { transform: translateY(-3px); filter: brightness(1.2); }

        table { width: 100%; border-collapse: separate; border-spacing: 0 10px; }
        th { text-align: left; padding: 15px; color: #555; font-size: 0.75rem; text-transform: uppercase; }
        td { padding: 20px; background: #1a1a2e; first-child { border-radius: 15px 0 0 15px; } last-child { border-radius: 0 15px 15px 0; } }

        .factura-box { background: #fff; color: #333; padding: 20px; border-radius: 10px; font-family: monospace; display: none; margin-top: 20px; }
    </style>
</head>
<body>

    <nav class="sidebar">
        <div style="text-align: center; margin-bottom: 40px;">
            <h2 style="color:var(--main); margin:0;">JP <span style="font-weight: 300; color:white;">ULTIMATE</span></h2>
            <small style="color:#444;">MICROEMPRESA ERP v3.0</small>
        </div>
        <div class="nav-item active" onclick="showPage('dashboard', this)"><i class="fas fa-th-large"></i> Vista General</div>
        <div class="nav-item" onclick="showPage('inventario', this)"><i class="fas fa-box-open"></i> Inventario</div>
        <div class="nav-item" onclick="showPage('ventas', this)"><i class="fas fa-shopping-bag"></i> Nueva Venta</div>
        <div class="nav-item" onclick="finalizarDia()" style="margin-top: auto; color: #ff5e57;"><i class="fas fa-calendar-times"></i> Cerrar Caja</div>
    </nav>

    <div class="main">
        
        <div id="dashboard" class="page active">
            <h1 style="margin-bottom: 30px;">Dashboard de Inteligencia</h1>
            <div class="stat-grid">
                <div class="stat-card">
                    <small>UTILIDAD NETA (COP)</small>
                    <div id="dash-ganancia" style="font-size: 1.8rem; color: var(--success); font-weight: 800;">$ 0</div>
                    <i class="fas fa-hand-holding-usd"></i>
                </div>
                <div class="stat-card" style="border-left-color: var(--accent);">
                    <small>ITEMS VENDIDOS</small>
                    <div id="dash-ventas" style="font-size: 1.8rem; font-weight: 800;">0</div>
                    <i class="fas fa-chart-line"></i>
                </div>
            </div>
            
            <div class="grid" style="display: grid; grid-template-columns: 1.5fr 1fr; gap: 25px;">
                <div class="card">
                    <h3>Gr√°fica de Rendimiento</h3>
                    <canvas id="ventasChart" height="150"></canvas>
                </div>
                <div class="card">
                    <h3>Cierres Recientes</h3>
                    <div id="historial-lista" style="font-size: 0.85rem; color: #888;"></div>
                </div>
            </div>
        </div>

        <div id="inventario" class="page">
            <h1>Gesti√≥n de Activos</h1>
            <div class="card">
                <h3>+ Registrar Nuevo Producto</h3>
                <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 15px;">
                    <input type="text" id="inv-nombre" placeholder="Nombre del Producto">
                    <input type="number" id="inv-costo" placeholder="Costo Unitario">
                    <input type="number" id="inv-venta" placeholder="P. Venta P√∫blico">
                    <input type="number" id="inv-stock" placeholder="Cantidad Inicial">
                </div>
                <button class="btn btn-main" onclick="agregarProducto()">Guardar en Nube Local</button>
            </div>
            <div class="card" style="overflow-x: auto;">
                <table>
                    <thead><tr><th>Producto</th><th>Costo</th><th>Venta</th><th>Stock Actual</th><th>Opciones</th></tr></thead>
                    <tbody id="tabla-inventario"></tbody>
                </table>
            </div>
        </div>

        <div id="ventas" class="page">
            <h1>Caja Registradora</h1>
            <div style="display: grid; grid-template-columns: 1.2fr 1fr; gap: 30px;">
                <div class="card">
                    <h3>1. Selecci√≥n de √çtem</h3>
                    <input type="text" id="busqueda" placeholder="üîç Escribe para buscar producto..." onkeyup="actualizarSelectVenta()">
                    <select id="select-venta" size="10" onchange="calcularVenta()"></select>
                </div>
                <div class="card">
                    <h3>2. Liquidaci√≥n</h3>
                    <label>Cantidad:</label>
                    <input type="number" id="v-cant" value="1" min="1" oninput="calcularVenta()">
                    <label>Descuento Especial (COP):</label>
                    <input type="number" id="v-desc" value="0" oninput="calcularVenta()" placeholder="Ej: 5000">
                    
                    <div style="background: rgba(0,255,136,0.05); padding: 25px; border-radius: 15px; border: 1px solid var(--success); text-align: center; margin-top: 15px;">
                        <small style="color: var(--success);">TOTAL A COBRAR</small>
                        <div id="v-total" style="font-size: 2.2rem; font-weight: 900; color: #fff;">$ 0</div>
                    </div>
                    
                    <button class="btn btn-accent" onclick="registrarVenta()">PROCESAR PAGO Y FACTURAR</button>
                    
                    <div id="factura-v" class="factura-box"></div>
                </div>
            </div>
        </div>

    </div>

<script>
    const fmt = new Intl.NumberFormat('es-CO', { style: 'currency', currency: 'COP', maximumFractionDigits: 0 });
    let db = JSON.parse(localStorage.getItem('jp_ultimate_db')) || { prods: [], ventas: [], hist: [] };
    let myChart;

    function showPage(pId, el) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(pId).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        el.classList.add('active');
        actualizarUI();
    }

    function agregarProducto() {
        const n = document.getElementById('inv-nombre').value, c = +document.getElementById('inv-costo').value, 
              v = +document.getElementById('inv-venta').value, s = +document.getElementById('inv-stock').value;
        if(n && c && v) {
            db.prods.push({ n, c, v, s, vh: 0 });
            save(); 
            document.querySelectorAll('#inventario input').forEach(i => i.value = "");
        }
    }

    function calcularVenta() {
        const idx = document.getElementById('select-venta').value;
        const cant = +document.getElementById('v-cant').value || 0;
        const desc = +document.getElementById('v-desc').value || 0;
        if(idx !== "") {
            const total = (db.prods[idx].v * cant) - desc;
            document.getElementById('v-total').innerText = fmt.format(total);
        }
    }

    function registrarVenta() {
        const idx = document.getElementById('select-venta').value, cant = +document.getElementById('v-cant').value, desc = +document.getElementById('v-desc').value;
        if(idx === "" || cant <= 0) return alert("Error en datos");
        const p = db.prods[idx];
        if(p.s >= cant) {
            p.s -= cant; p.vh += cant;
            const totalV = (p.v * cant) - desc;
            const util = totalV - (p.c * cant);
            db.ventas.push({ n: p.n, g: util, v: totalV, c: cant });
            
            // Generar Factura Visual
            const f = document.getElementById('factura-v');
            f.style.display = "block";
            f.innerHTML = `*** RECIBO JP ***<br>${new Date().toLocaleString()}<br>ITEM: ${p.n}<br>CANT: ${cant}<br>DESC: ${fmt.format(desc)}<br>TOTAL: ${fmt.format(totalV)}<br>¬°Gracias por su compra!`;
            
            save();
            alert("Venta Exitosa");
        } else alert("Sin Stock");
    }

    function finalizarDia() {
        if(!db.ventas.length) return alert("Caja vac√≠a");
        const g = db.ventas.reduce((a,b) => a + b.g, 0), v = db.ventas.reduce((a,b) => a + b.v, 0);
        db.hist.unshift({ f: new Date().toLocaleDateString(), g, v, c: db.ventas.length });
        db.ventas = []; db.prods.forEach(p => p.vh = 0);
        save();
        alert("Cierre de caja generado.");
    }

    function save() { localStorage.setItem('jp_ultimate_db', JSON.stringify(db)); actualizarUI(); }

    function actualizarUI() {
        // Tabla
        document.getElementById('tabla-inventario').innerHTML = db.prods.map((p, i) => `
            <tr><td><b>${p.n}</b></td><td>${fmt.format(p.c)}</td><td>${fmt.format(p.v)}</td>
            <td style="color:${p.s < 5 ? '#ff5e57' : '#00ff88'}">${p.s} und</td>
            <td><button onclick="db.prods.splice(${i},1);save()" style="background:none; border:none; color:#555; cursor:pointer;">‚úñ</button></td></tr>
        `).join('');

        actualizarSelectVenta();

        // Stats
        const gHoy = db.ventas.reduce((a,b) => a + b.g, 0);
        document.getElementById('dash-ganancia').innerText = fmt.format(gHoy);
        document.getElementById('dash-ventas').innerText = db.ventas.reduce((a,b) => a + b.c, 0);
        
        // Historial
        document.getElementById('historial-lista').innerHTML = db.hist.slice(0,5).map(h => `
            <div style="margin-bottom:10px; border-bottom:1px solid #222; padding-bottom:5px;">
                üìÖ ${h.f} - Ganancia: <span style="color:var(--success)">${fmt.format(h.g)}</span>
            </div>
        `).join('');

        initChart();
    }

    function actualizarSelectVenta() {
        const q = document.getElementById('busqueda').value.toLowerCase();
        document.getElementById('select-venta').innerHTML = db.prods
            .map((p, i) => ({p, i})).filter(x => x.p.n.toLowerCase().includes(q))
            .map(x => `<option value="${x.i}">${x.p.n.toUpperCase()} [Stock: ${x.p.s}]</option>`).join('');
    }

    function initChart() {
        const ctx = document.getElementById('ventasChart').getContext('2d');
        if(myChart) myChart.destroy();
        myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: db.hist.slice(0,7).reverse().map(h => h.f),
                datasets: [{ label: 'Ganancias por d√≠a', data: db.hist.slice(0,7).reverse().map(h => h.g), backgroundColor: '#00d2ff' }]
            },
            options: { scales: { y: { beginAtZero: true } }, plugins: { legend: { display: false } } }
        });
    }

    actualizarUI();
</script>
</body>
</html>
